# æ‰¹é‡ç”Ÿæˆè¯­æ³•è¯¦è§£

## æ¦‚è¿°

Pyruns æ”¯æŒåœ¨ YAML é…ç½®å€¼ä¸­ä½¿ç”¨ `|` ç®¡é“è¯­æ³•æ¥å£°æ˜å¤šå€¼å‚æ•°ï¼Œè‡ªåŠ¨ç”Ÿæˆæ‰€æœ‰å‚æ•°ç»„åˆçš„ä»»åŠ¡ã€‚

## ä¸¤ç§è¯­æ³•

### Product è¯­æ³• â€” ç¬›å¡å°”ç§¯

ä½¿ç”¨è£¸ `|` åˆ†éš”å¤šä¸ªå€¼ï¼š

```yaml
lr: 0.001 | 0.01 | 0.1
batch_size: 32 | 64
```

**æ•ˆæœ**ï¼šç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„ç»„åˆï¼ˆç¬›å¡å°”ç§¯ï¼‰ã€‚

```
lr=0.001, batch_size=32
lr=0.001, batch_size=64
lr=0.01,  batch_size=32
lr=0.01,  batch_size=64
lr=0.1,   batch_size=32
lr=0.1,   batch_size=64
```

**æ€»æ•°**ï¼š3 Ã— 2 = **6 ä¸ªä»»åŠ¡**

### Zip è¯­æ³• â€” é…å¯¹ç»„åˆ

ä½¿ç”¨ `(|)` æ‹¬å·åŒ…è£¹ï¼š

```yaml
seed: (1 | 2 | 3)
name: (alpha | beta | gamma)
```

**æ•ˆæœ**ï¼šæŒ‰ä½ç½®é…å¯¹ï¼ˆç±»ä¼¼ Python çš„ `zip()`ï¼‰ã€‚

```
seed=1, name=alpha
seed=2, name=beta
seed=3, name=gamma
```

**æ€»æ•°**ï¼š**3 ä¸ªä»»åŠ¡**

**çº¦æŸ**ï¼šæ‰€æœ‰ Zip å‚æ•°å¿…é¡»æœ‰ç›¸åŒæ•°é‡çš„å€¼ã€‚

### æ··åˆä½¿ç”¨

Product å’Œ Zip å¯ä»¥åŒæ—¶ä½¿ç”¨ï¼š

```yaml
# Product å‚æ•°
lr: 0.001 | 0.01 | 0.1
batch_size: 32 | 64

# Zip å‚æ•°
seed: (1 | 2 | 3)
name: (alpha | beta | gamma)

# å›ºå®šå‚æ•°
epochs: 100
model: resnet50
```

**æ€»æ•°**ï¼šProduct Ã— Zip = (3 Ã— 2) Ã— 3 = **18 ä¸ªä»»åŠ¡**

**å…¬å¼**ï¼š\( \text{Total} = \prod(\text{product counts}) \times \text{zip length} \)

## å®Œæ•´ç¤ºä¾‹

### è¾“å…¥é…ç½®

```yaml
# è¶…å‚æœç´¢å®éªŒ
training:
  lr: 0.001 | 0.01
  optimizer: adam | sgd

model:
  hidden_size: 128 | 256

# æ§åˆ¶å˜é‡ â€” æ¯ç»„å®éªŒå›ºå®šç§å­
seed: (42 | 123 | 777)
run_name: (trial_a | trial_b | trial_c)

# å…¶ä½™å‚æ•°å›ºå®š
epochs: 50
dataset: cifar10
```

### ç”Ÿæˆçš„ä»»åŠ¡

| # | lr | optimizer | hidden_size | seed | run_name |
|---|------|-----------|-------------|------|----------|
| 1 | 0.001 | adam | 128 | 42 | trial_a |
| 2 | 0.001 | adam | 128 | 123 | trial_b |
| 3 | 0.001 | adam | 128 | 777 | trial_c |
| 4 | 0.001 | adam | 256 | 42 | trial_a |
| ... | ... | ... | ... | ... | ... |
| 24 | 0.01 | sgd | 256 | 777 | trial_c |

**æ€»æ•°**ï¼š(2 Ã— 2 Ã— 2) Ã— 3 = **24 ä¸ªä»»åŠ¡**

### ç”Ÿæˆåçš„ç›®å½•ç»“æ„

```
_pyruns_/
â”œâ”€â”€ my-exp-[1-of-24]/
â”‚   â”œâ”€â”€ task_info.json
â”‚   â”œâ”€â”€ config.yaml     â† lr=0.001, optimizer=adam, hidden_size=128, seed=42
â”‚   â””â”€â”€ run.log
â”œâ”€â”€ my-exp-[2-of-24]/
â”‚   â”œâ”€â”€ config.yaml     â† lr=0.001, optimizer=adam, hidden_size=128, seed=123
â”‚   â””â”€â”€ ...
â””â”€â”€ my-exp-[24-of-24]/
    â””â”€â”€ ...
```

## ç±»å‹æ¨æ–­

ç®¡é“è¯­æ³•ä¸­çš„æ¯ä¸ªå€¼ä¼šè‡ªåŠ¨æ¨æ–­ç±»å‹ï¼š

| è¾“å…¥ | æ¨æ–­ä¸º |
|------|--------|
| `0.001` | `float` |
| `42` | `int` |
| `true` | `bool` |
| `adam` | `str` |
| `[1, 2]` | `list` |
| `None` | `NoneType` |

## åµŒå¥—å‚æ•°æ”¯æŒ

ç®¡é“è¯­æ³•æ”¯æŒåœ¨åµŒå¥—å­—å…¸çš„å¶å­èŠ‚ç‚¹ä¸­ä½¿ç”¨ï¼š

```yaml
model:
  architecture: resnet | vgg | densenet
  layers:
    hidden: 128 | 256
    output: 10
```

å†…éƒ¨ä½¿ç”¨ `flatten_dict()` å°†å…¶å±•å¹³ä¸ºï¼š

```
model.architecture: resnet | vgg | densenet   â†’ product, 3 values
model.layers.hidden: 128 | 256                â†’ product, 2 values
model.layers.output: 10                       â†’ fixed
```

æ€»ä»»åŠ¡æ•°ï¼š3 Ã— 2 = **6**

## ç¡®è®¤å¯¹è¯æ¡†

å½“æ£€æµ‹åˆ°ç®¡é“è¯­æ³•æ—¶ï¼ˆä»»åŠ¡æ•° > 1ï¼‰ï¼Œç‚¹å‡» GENERATE ä¼šå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”® æ‰¹é‡ç”Ÿæˆç¡®è®¤                    [24] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä»»åŠ¡å‰ç¼€: my-exp                        â”‚
â”‚ my-exp-[1-of-24] ~ my-exp-[24-of-24]   â”‚
â”‚                                          â”‚
â”‚ ğŸ”€ Product å‚æ•° (ç¬›å¡å°”ç§¯)  2Ã—2Ã—2 = 8  â”‚
â”‚ â”œâ”€ lr:           0.001 | 0.01           â”‚
â”‚ â”œâ”€ optimizer:    adam | sgd             â”‚
â”‚ â””â”€ hidden_size:  128 | 256             â”‚
â”‚                                          â”‚
â”‚ ğŸ”— Zip å‚æ•° (é…å¯¹ç»„åˆ)          Ã—3      â”‚
â”‚ â”œâ”€ seed:      42 | 123 | 777           â”‚
â”‚ â””â”€ run_name:  trial_a | trial_b | ...  â”‚
â”‚                                          â”‚
â”‚ ğŸ“Š Total = 2 Ã— 2 Ã— 2 Ã— 3 = 24         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    [å–æ¶ˆ]  [ç¡®è®¤ç”Ÿæˆ 24] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## `_meta_desc` å­—æ®µ

æ¯ä¸ªç”Ÿæˆçš„é…ç½®ä¼šè‡ªåŠ¨é™„åŠ ä¸€ä¸ª `_meta_desc` å­—æ®µï¼Œè®°å½•è¯¥ä»»åŠ¡ä¸å…¶ä»–ä»»åŠ¡ä¸åŒçš„å‚æ•°å€¼ï¼š

```yaml
# config.yaml
lr: 0.001
optimizer: adam
hidden_size: 128
seed: 42
run_name: trial_a
_meta_desc: "lr=0.001, optimizer=adam, hidden_size=128, seed=42, run_name=trial_a"
```

æ­¤å­—æ®µä»¥ `_meta` å¼€å¤´ï¼Œåœ¨ä¿å­˜åˆ° `config.yaml` æ—¶ä¼šè¢«è‡ªåŠ¨è¿‡æ»¤ã€‚

## é”™è¯¯å¤„ç†

### Zip é•¿åº¦ä¸åŒ¹é…

```yaml
seed: (1 | 2 | 3)
name: (alpha | beta)       # â† åªæœ‰ 2 ä¸ªå€¼ï¼
```

**é”™è¯¯**ï¼š`ValueError: All (zip) parameters must have equal length. Got: seed=3, name=2`

### æ— ç®¡é“è¯­æ³•

å¦‚æœé…ç½®ä¸­æ²¡æœ‰ä»»ä½• `|` è¯­æ³•ï¼Œç‚¹å‡» GENERATE å°†ç›´æ¥ç”Ÿæˆ 1 ä¸ªä»»åŠ¡ï¼Œæ— éœ€ç¡®è®¤ã€‚

## ç›¸å…³ API

| å‡½æ•° | æ¨¡å— | ç”¨é€” |
|------|------|------|
| `generate_batch_configs()` | `utils.config_utils` | ç”Ÿæˆæ‰€æœ‰å‚æ•°ç»„åˆ |
| `count_batch_configs()` | `utils.config_utils` | é¢„è§ˆä»»åŠ¡æ•°é‡ |
| `strip_batch_pipes()` | `utils.config_utils` | å»é™¤ç®¡é“è¯­æ³•ï¼ˆå–é¦–ä¸ªå€¼ï¼‰ |
| `_parse_pipe_value()` | `utils.config_utils` | è§£æå•ä¸ªå€¼çš„ç®¡é“è¯­æ³• |
| `flatten_dict()` | `utils.config_utils` | å±•å¹³åµŒå¥—å­—å…¸ |
| `unflatten_dict()` | `utils.config_utils` | è¿˜åŸåµŒå¥—å­—å…¸ |

