# UI 操作指南

通过 `pyr train.py` 或者 `pyr dev train.py` 启动后，应用由三个核心页面和一个可见的系统性能看板组成。

---

## 顶部系统面板

所有页面共享，实时显示运行环境对应的物理机器资源状态（默认每 3 秒刷新）：

```text
[CPU 45%]  [RAM 68%]  [G0 85% 8192/24576M]  [G1 12% 1024/24576M]
```

- **CPU / RAM**：系统整体的 CPU 利用率与内存占有率。
- **GPU (Gn)**：识别环境中 NVIDIA GPU 的计算负载及对应显存分配情况。

---

## Generator — 参数配置与任务生成

**在此页面配置模板参数，并支持利用管道语法实现配置网格的规模化生成。**

![Generator 页面概览](assets/tab_generator.png)

### 编辑模式

在左上角 `Template` 下拉框选中参数模板（默认关联 `config_default.yaml`）后，平台提供两种参数编辑视图：

**Form 视图**（结构化表单界面）
- 支持列布局的动态调节（1–9 列区间）。
- 提供字典结构的自动折叠与层级排布。
- **Pin（置顶固定）**：在参数量较大时，提供将核心目标参数固定在视图顶端的功能，便于频繁修改或调试。

**YAML 视图**（纯文本编辑器）
- 内置 CodeMirror 提供基于缩进的 YAML 语法高亮。
- 适合于进行复杂的批量修改，或通过复制外部配置文本导入使用。

### 批量生成与网格化

在编辑框支持使用特定语法结构展开参数空间：

| 语法 | 类型 | 效果 |
|------|------|------|
| `\|` | 笛卡尔积组合 | `batch_size: 32 \| 64 \| 128` 将引发包含不同数值的 3 个独立任务分支。 |
| `(\|)` | 一一对应配对 | 设定 `model: (ResNet \| VGG)` 及 `lr: (0.1 \| 0.01)` 会同步映射为 2 个独立的实验流。 |

设定特定前缀或保持空缺（时间戳）后，点击 **GENERATE**。系统底层将解析定义并持久化对应数量的任务配置快照。

---

## Manager — 并发调度列表

**通过网格列表监控任务状况，进行条件过滤和启动批处理操作。**

![Manager 页面概览](assets/tab_manager.png)

### 任务控制板特性

- **状态过滤按键**：依据任务标识（如 `Pending` / `Running` / `Completed` 等）进行状态截取。
- **模糊搜索框**：对列表内所有任务名称、相关的快照参数以及用户的文本笔记内容执行关键字查检。
- **动态排布**：卡片支持根据当前视图自动缩放在 1–9 列之间分配。

### 并行执行参数配置

右侧管控面板提供了相关的运行调度限制参数：

| 选项名 | 配置说明 |
|------|------|
| **Workers** | 所允许的最大进程/线程并发数限制，到达该阈值后将进行任务队列排队。 |
| **Thread 模式** | 主进程拉起线程异步执行，适合于存在底层 GIL 释放逻辑或负载不重的调用任务（默认启动模式）。 |
| **Process 模式** | 发起原生操作系统的进程启动进行全隔离计算，通常用于 CPU 计算密集的高开销计算任务。 |

全选或者勾选局部任务卡片后，点击 **RUN SELECTED** 将提交执行指令至队列控制端。

### 任务元快照弹窗

点击当前列表内任务后所呼出的明细面板提供以下监控入口：

| 选卡 | 显示内容 |
|--------|------|
| **Task Info** | 包含创建节点时间、历史总耗时统计、运行 PID 标识及其历次重跑列表轨迹记录。 |
| **Config** | 固定映射于当前任务环境绑定的最终实际参数文件 (`config.yaml`)。 |
| **Run Log** | 获取输出缓存；发生运行崩溃后展示对应拆分的异常栈定位结果。 |
| **Notes** | 支持用户保存额外的试验附注或文本总结。 |
| **Env Vars** | 该任务执行初始化时获取的所有相关系统及特定环境变量留档记录。 |

---

## Monitor — 运行日志与报告模块

**实时输出环境对接的流终端以及各运行任务监测指标聚合导出点。**

![Monitor 页面概览](assets/tab_monitor.png)

### 日志可视化流大屏

在列表选中处于 `Queued` 和 `Running` 分配组别的实验对象后，面板获取即时的程序内部标准输出表现：

- **ANSI 控制符渲染转译**：基于 HTML 原生结构完整对应字符着色标准输出，以实现 `tqdm` 类更新显示支持。
- **追踪滚动**：自动执行向下追底滚动定位行为；若发起主动页面上的滚轮拖拽即可终端当前锁定从而检视前期记录。

### 数据报告获取

当运行逻辑内部集成了指标搜集调用（存入 `task_info.json->monitors` 队列）：

```python
pyruns.add_monitor(loss=curr_loss, auc=curr_auc)
```

系统支持汇总操作：
1. 于视图侧列出欲分析完毕的实验组别项并勾选。
2. 调用管理栏内的 **Export Reports** 动作按钮。
3. 框架根据指定文件扩展请求合并全时序报告（可选项包含逗号分隔值格式 `CSV` 及文本化数组结构的 `JSON`）。

---

## 数据持久化规范 (回收站策略)

| 返回状态 | 图标提示 | 状态释义 |
|------|------|------|
| `Pending` | 灰色 ⏰ | 配置已展开生成，准备中 |
| `Queued` | 蓝色 ⏳ | 任务获得队列进入许可，等待被调度资源分配 |
| `Running` | 琥珀色 ▶ | 定时刷新生命周期监听事件，系统正运转下发指令 |
| `Completed` | 绿色 ✓ | 进程成功回调（返回状态码位 0） |
| `Failed` | 红色 ✗ | 发生执行级别或调用处级别中断抛出（异常退出代码反馈） |

执行任何清理或删除任务命令后，系统并非立刻格式化目录，而是转移至内部废止保护层目录 `.trash/` 下予以挂起，用户亦可根据实际需要人工予以找回合并。
