# UI 操作指南

通过 `pyr train.py` 启动后，应用由三个核心页面和一个始终可见的顶部系统面板组成。

---

## 顶部系统面板

所有页面共享，实时显示机器资源状态（每 3 秒刷新）：

```text
[CPU 45%]  [RAM 68%]  [G0 85% 8192/24576M]  [G1 12% 1024/24576M]
```

- **CPU / RAM**：物理机整体资源使用率
- **GPU (Gn)**：自动识别环境中的所有 NVIDIA 显卡（需 `nvidia-smi`）

---

## Generator — 参数配置与任务生成

**在此页面配置参数并批量生成任务。**

![Generator 页面概览](assets/tab_generator.png)

### 编辑模式

在左侧 `Template` 下拉框选中参数模板（默认加载 `config_default.yaml`）后，支持两种编辑方式：

**Form 视图**（图形化）
- 动态列布局（1–9 列）
- 嵌套字典自动折叠
- Pin 图钉置顶高频修改参数

**YAML 视图**（源码级）
- CodeMirror 高亮编辑器
- 适合复杂修改或粘贴外部配置

### 批量生成

在编辑框内使用管道语法即可声明参数网格（详见 [批量语法](batch-syntax.md)）：

| 语法 | 效果 | 示例 |
|------|------|------|
| `\|` | 笛卡尔积 | `batch_size: 32 \| 64 \| 128` → 3 个任务 |
| `(\|)` | 配对组合 | `model: (ResNet \| VGG)` + `lr: (0.1 \| 0.01)` → 2 个任务 |

输入任务名称前缀后点击 **GENERATE**，系统批量创建任务记录。

---

## Manager — 任务控制台

**卡片网格形式管理、筛选并批量运行任务。**

![Manager 页面概览](assets/tab_manager.png)

### 任务列表

- **状态过滤**：顶栏按钮快速筛选 Pending / Running / Completed / Failed
- **模糊搜索**：支持任务名称、参数值、笔记内容关键字检索
- **自定义视图**：卡片列数可调（1–9 列）

### 并行执行

右上角提供执行控制：

| 选项 | 说明 |
|------|------|
| **Workers** | 最大并发数 |
| **Thread 模式** | 适用于 I/O 密集型或资源消耗较小的脚本（默认） |
| **Process 模式** | 进程级隔离，适用于 CPU 密集型任务 |

批量选中任务后，点击 **RUN SELECTED** 即可调度执行。

### 任务详情

点击任务卡片弹出详情窗口：

| 标签页 | 内容 |
|--------|------|
| **Task Info** | 创建时间、执行耗时、PID、重跑 (Rerun) 历史 |
| **Config** | 该任务的参数快照 (`config.yaml`) |
| **Run Log** | 终端输出，可切换当前和历史执行日志 |
| **Notes** | 自定义备注，支持随时编辑保存 |
| **Env Vars** | 任务启动时捕获的环境变量 |

---

## Monitor — 实时日志与报告导出

**流式终端监控 + 跨任务指标聚合导出。**

![Monitor 页面概览](assets/tab_monitor.png)

### 流式终端

选中正在运行的任务，即可实时查看终端输出：

- **ANSI 颜色**：完整支持 `tqdm` 进度条与 `colorama` 着色的网页渲染
- **增量推送**：基于偏移量的块级读取，避免大文件的重复拉取
- **Auto-Scroll**：自动追踪到最新输出行

### 导出报告

在脚本中使用 `pyruns.add_monitor()` 记录关键指标后：

```python
pyruns.add_monitor(loss=curr_loss, auc=curr_auc)
```

1. 在 Monitor 页面左侧勾选目标任务
2. 点击 **Export Reports**
3. 选择 **CSV** 或 **JSON** 格式导出跨任务汇总报告

---

## 任务状态

| 状态 | 标记 | 说明 |
|------|------|------|
| `Pending` | 灰色 ⏰ | 已创建，等待调度 |
| `Queued` | 蓝色 ⏳ | 已加入执行队列，等待资源 |
| `Running` | 琥珀色 ▶ | 子进程正在执行 |
| `Completed` | 绿色 ✓ | 正常退出（Exit Code 0） |
| `Failed` | 红色 ✗ | 异常退出（Exit Code > 0） |

**软删除**：界面中的删除操作会将任务移至 `.trash/` 目录，支持手动恢复。

