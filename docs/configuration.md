# é…ç½®ç³»ç»Ÿ

## æ¦‚è¿°

Pyruns çš„é…ç½®ç³»ç»Ÿå›´ç»• YAML æ–‡ä»¶æ„å»ºï¼Œæ”¯æŒåµŒå¥—ç»“æ„ã€è‡ªåŠ¨ç±»å‹æ¨æ–­å’Œæ‰¹é‡å‚æ•°å±•å¼€ã€‚æ•´ä¸ªé…ç½®ä½“ç³»åˆ†ä¸ºä¸‰ä¸ªå±‚æ¬¡ï¼š

| å±‚æ¬¡ | æ–‡ä»¶ | è¯´æ˜ |
|------|------|------|
| **å‚æ•°æ¨¡æ¿** | `config_default.yaml` | è„šæœ¬çš„é»˜è®¤å‚æ•°åŸºå‡†ï¼Œç”± `pyr` è‡ªåŠ¨ç”Ÿæˆæˆ–ç”¨æˆ·å¯¼å…¥ |
| **ä»»åŠ¡å¿«ç…§** | `config.yaml` | æ¯æ¬¡ç”Ÿæˆä»»åŠ¡æ—¶çš„å‚æ•°å‰¯æœ¬ï¼Œä¿å­˜åœ¨å„ä»»åŠ¡ç›®å½•ä¸‹ |
| **ä»»åŠ¡å…ƒæ•°æ®** | `task_info.json` | ä»»åŠ¡çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸæ•°æ®ï¼ˆçŠ¶æ€ã€æ—¶é—´ã€PIDã€ç¬”è®°ç­‰ï¼‰ |

---

## é…ç½®æ–‡ä»¶

### `config_default.yaml` â€” å‚æ•°æ¨¡æ¿

å­˜æ”¾åœ¨ `_pyruns_/{script}/` ç›®å½•ä¸‹ï¼Œæ˜¯ Generator é¡µé¢çš„å‚æ•°æ¥æºã€‚

**ç”Ÿæˆæ–¹å¼ï¼ˆä¸‰é€‰ä¸€ï¼‰**ï¼š

| æ–¹å¼ | è§¦å‘æ¡ä»¶ | è¡Œä¸º |
|------|----------|------|
| **Argparse è‡ªåŠ¨è§£æ** | `pyr train.py`ï¼ˆè„šæœ¬å« `argparse`ï¼‰ | AST é™æ€åˆ†ææå–æ‰€æœ‰å‚æ•°é»˜è®¤å€¼å¹¶ç”Ÿæˆ |
| **YAML å¯¼å…¥** | `pyr train.py my_config.yaml` | å°† `my_config.yaml` å¤åˆ¶ä¸º `config_default.yaml` |
| **pyruns.load() æ¨¡å¼** | è„šæœ¬ä½¿ç”¨ `pyruns.load()` | è¦æ±‚ `config_default.yaml` å·²å­˜åœ¨ï¼Œå¦åˆ™æŠ¥é”™å¹¶å¼•å¯¼ç”¨æˆ·å¯¼å…¥ |

> åç»­è¿è¡Œ `pyr train.py`ï¼ˆä¸å¸¦ YAML å‚æ•°ï¼‰æ—¶ï¼Œå§‹ç»ˆè‡ªåŠ¨åŠ è½½å·²æœ‰çš„ `config_default.yaml`ã€‚å†æ¬¡ä¼ å…¥æ–° YAML ä¼šè¦†ç›–æ—§æ¨¡æ¿ã€‚

```yaml
# Auto-generated for train.py

lr: 0.001  # å­¦ä¹ ç‡
epochs: 10  # è®­ç»ƒè½®æ•°
batch_size: 32  # æ‰¹å¤§å°
model: resnet50
```

**åœ¨ Generator ä¸­çš„è¡Œä¸º**ï¼š
- ä»¥åªè¯»æ¨¡æ¿å½¢å¼åŠ è½½ï¼ˆå·¦ä¸Šè§’ ğŸ”’ æ ‡è®°ï¼‰
- ç”¨æˆ·ç¼–è¾‘çš„æ˜¯å†…å­˜å‰¯æœ¬ï¼ŒåŸå§‹æ–‡ä»¶ä¸å—å½±å“
- ç”Ÿæˆä»»åŠ¡æ—¶ï¼Œå‚æ•°å†™å…¥å„ä»»åŠ¡ç›®å½•çš„ç‹¬ç«‹ `config.yaml`

### `config.yaml` â€” ä»»åŠ¡çº§å¿«ç…§

æ¯ä¸ªä»»åŠ¡ç›®å½•åŒ…å«ä¸€ä¸ªç‹¬ç«‹çš„ `config.yaml`ï¼Œæ˜¯ç”Ÿæˆä»»åŠ¡æ—¶çš„å‚æ•°å¿«ç…§ï¼š

```yaml
lr: 0.01
epochs: 20
batch_size: 64
model: resnet50
```

- æ‰¹é‡ç”Ÿæˆæ—¶ï¼Œæ¯ä¸ªä»»åŠ¡çš„ `config.yaml` å„è‡ªåŒ…å«è¯¥ä»»åŠ¡çš„å‚æ•°ç»„åˆ
- å†…éƒ¨å…ƒæ•°æ®å­—æ®µï¼ˆä»¥ `_meta` å¼€å¤´çš„é”®ï¼‰ä¼šè¢«è‡ªåŠ¨è¿‡æ»¤

### `task_info.json` â€” ä»»åŠ¡å…ƒæ•°æ®

è®°å½•ä»»åŠ¡çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸæ•°æ®ï¼š

```json
{
    "id": "2026-02-13_10-30-45_1707817845123",
    "name": "baseline-[1-of-6]",
    "status": "completed",
    "created_at": "2026-02-13 10:30:45",
    "progress": 1.0,
    "pinned": false,
    "env": {
        "CUDA_VISIBLE_DEVICES": "0"
    },
    "script": "/path/to/train.py",
    "run_at": "2026-02-13 10:31:00",
    "run_pid": null,
    "rerun_at": ["2026-02-13 11:00:00"],
    "rerun_pid": [null],
    "notes": "é¦–æ¬¡å®éªŒï¼Œbaseline é…ç½®",
    "monitors": [
        {"loss": 0.234, "acc": 95.2, "_ts": "2026-02-13 10:31:05"}
    ]
}
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `id` | `string` | å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆæ—¶é—´æˆ³ + æ¯«ç§’ï¼‰ |
| `name` | `string` | æ˜¾ç¤ºåç§°ï¼ˆ= ç›®å½•åï¼‰ |
| `status` | `string` | `pending` / `queued` / `running` / `completed` / `failed` |
| `created_at` | `string` | åˆ›å»ºæ—¶é—´ |
| `progress` | `float` | è¿›åº¦ 0.0 ~ 1.0 |
| `pinned` | `bool` | æ˜¯å¦ç½®é¡¶ |
| `env` | `dict` | ç¯å¢ƒå˜é‡ï¼ˆå¦‚ `CUDA_VISIBLE_DEVICES`ï¼‰ |
| `script` | `string` | ç”¨æˆ·è„šæœ¬çš„ç»å¯¹è·¯å¾„ |
| `run_at` | `string?` | é¦–æ¬¡è¿è¡Œæ—¶é—´ |
| `run_pid` | `int?` | é¦–æ¬¡è¿è¡Œçš„è¿›ç¨‹ PIDï¼ˆç»“æŸåä¸º nullï¼‰ |
| `rerun_at` | `list[string]` | æ¯æ¬¡é‡è·‘çš„æ—¶é—´ |
| `rerun_pid` | `list[int?]` | æ¯æ¬¡é‡è·‘çš„ PID |
| `notes` | `string` | ç”¨æˆ·ç¬”è®° |
| `monitors` | `list[dict]` | ç›‘æ§æ•°æ®æ¡ç›®åˆ—è¡¨ |

## ConfigNode â€” ç‚¹å·è®¿é—®é…ç½®

`pyruns.load()` è¿”å›ä¸€ä¸ª `ConfigNode` å¯¹è±¡ï¼Œæ”¯æŒå±æ€§é£æ ¼çš„ç‚¹å·è®¿é—®ï¼š

```python
config = pyruns.load()

# åŸºç¡€ç±»å‹
config.lr          # 0.001
config.epochs      # 10

# åµŒå¥—ç»“æ„
config.model.name  # "resnet50"
config.model.layers  # [64, 128, 256]

# è½¬å›å­—å…¸
config.to_dict()   # {"lr": 0.001, "epochs": 10, "model": {"name": "resnet50", ...}}
```

**æ”¯æŒçš„é…ç½®æ–‡ä»¶æ ¼å¼**ï¼š
- `.yaml` / `.yml`
- `.json`

## ç±»å‹æ¨æ–­

é…ç½®å€¼ä»å­—ç¬¦ä¸²è¾“å…¥è‡ªåŠ¨æ¨æ–­ç±»å‹ï¼ˆç”± `parse_value()` å¤„ç†ï¼‰ï¼š

| è¾“å…¥ | æ¨æ–­ç±»å‹ | ç»“æœ |
|------|----------|------|
| `42` | `int` | `42` |
| `3.14` | `float` | `3.14` |
| `true` / `True` | `bool` | `True` |
| `false` / `False` | `bool` | `False` |
| `[1, 2, 3]` | `list` | `[1, 2, 3]` |
| `hello` | `str` | `"hello"` |
| `None` | `NoneType` | `None` |

## åµŒå¥—é…ç½®

YAML çš„åµŒå¥—ç»“æ„åœ¨ Pyruns ä¸­å®Œå…¨æ”¯æŒï¼š

```yaml
# config_default.yaml
model:
  name: resnet50
  hidden_size: 256
  dropout: 0.1

training:
  lr: 0.001
  epochs: 100
  scheduler:
    type: cosine
    warmup: 5
```

åœ¨ Generator é¡µé¢ä¸­ï¼ŒåµŒå¥—å­—å…¸æ˜¾ç¤ºä¸ºå¯æŠ˜å çš„åˆ†ç»„ã€‚

åœ¨è„šæœ¬ä¸­ä½¿ç”¨ï¼ˆMode 2ï¼‰ï¼š

```python
config = pyruns.load()
config.model.name          # "resnet50"
config.training.scheduler.type  # "cosine"
```

## ç¯å¢ƒå˜é‡é…ç½®ï¼ˆPer-Taskï¼‰

æ¯ä¸ªä»»åŠ¡å¯ä»¥åœ¨ Task Dialog çš„ **Env Vars** æ ‡ç­¾é¡µä¸­è®¾ç½®ç‹¬ç«‹çš„ç¯å¢ƒå˜é‡ï¼š

```json
{
    "CUDA_VISIBLE_DEVICES": "0,1",
    "MASTER_PORT": "29500",
    "OMP_NUM_THREADS": "4"
}
```

è¿™äº›ç¯å¢ƒå˜é‡åœ¨ä»»åŠ¡æ‰§è¡Œæ—¶é€šè¿‡ `executor.py` çš„ `_prepare_env()` æ³¨å…¥åˆ°å­è¿›ç¨‹ç¯å¢ƒä¸­ã€‚

## é…ç½®æŸ¥æ‰¾ä¼˜å…ˆçº§

`pyruns.read()` æŒ‰å¦‚ä¸‹é¡ºåºæŸ¥æ‰¾é…ç½®æ–‡ä»¶ï¼š

| ä¼˜å…ˆçº§ | æ¥æº | è¯´æ˜ |
|--------|------|------|
| 1 | ç¯å¢ƒå˜é‡ `__PYRUNS_CONFIG__` | ç”± `pyr` executor è‡ªåŠ¨è®¾ç½®ï¼ŒæŒ‡å‘å½“å‰ä»»åŠ¡çš„ `config.yaml` |
| 2 | æ˜¾å¼ä¼ å…¥çš„ `file_path` | `pyruns.read("my_config.yaml")` |
| 3 | é»˜è®¤è·¯å¾„ | `_pyruns_/{script}/config_default.yaml` |

**å·¥ä½œæµè¯´æ˜**ï¼š
- é€šè¿‡ `pyr` è¿è¡Œä»»åŠ¡æ—¶ï¼Œexecutor ä¼šè‡ªåŠ¨è®¾ç½® `__PYRUNS_CONFIG__` æŒ‡å‘ä»»åŠ¡ç›®å½•çš„ `config.yaml`ï¼Œç”¨æˆ·è„šæœ¬ä¸­çš„ `pyruns.read()` / `pyruns.load()` ä¼šè‡ªåŠ¨è¯»å–
- ç›´æ¥ `python train.py` è¿è¡Œæ—¶ï¼ŒæŒ‰ä¼˜å…ˆçº§ 2â†’3 æŸ¥æ‰¾

---

## å…¨å±€è®¾ç½® `_pyruns_settings.yaml`

Pyruns çš„é…ç½®å±‚æ˜ç¡®åˆ†ç¦»ï¼š

| æ–‡ä»¶ | ä½œç”¨ | ä¿®æ”¹æ–¹å¼ |
|------|------|----------|
| `_pyruns_settings.yaml` | ç”¨æˆ·å¯å®šåˆ¶çš„ UI è®¾ç½®ï¼ˆç«¯å£ã€å¹¶å‘æ•°ã€åˆ—æ•°ç­‰ï¼‰ | æ‰‹åŠ¨ç¼–è¾‘æˆ– UI å†…ä¿®æ”¹ |
| `pyruns/_config.py` | ç³»ç»Ÿçº§å¸¸é‡ï¼ˆç›®å½•åã€ç¯å¢ƒå˜é‡åç­‰ï¼‰ | ä»…å¼€å‘è€…ä¿®æ”¹ |
| `pyruns/ui/theme.py` | è§†è§‰ç³»ç»Ÿï¼ˆCSS ç±»åã€é¢œè‰²æ˜ å°„ã€å›¾æ ‡ï¼‰ | ä»…å¼€å‘è€…ä¿®æ”¹ |

